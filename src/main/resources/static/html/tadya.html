<!DOCTYPE html>
<html>
<head>
    <title>Tadya</title>
    <meta charset="utf-8" />

    <script
            type="text/javascript"
            src="https://www.bing.com/api/maps/mapcontrol?callback=GetMap&setMkt=tr-TR&setLang=tr&branch=release&key=AtEGXpWltd3FqxpW2NOpPSpz_YQb5XUTt1dwFLrQbtSEyvA1GwIo8TnARNadz3iS"
            async
            defer
    ></script>
    <script src="../js/handler.js"> </script>
    <script src="../js/login.js"></script>
    <link rel="stylesheet" href="../css/style.css" />
    <script type="text/javascript">
    let levelofdestruction;

    var currentPolygon;
    var currentBuilding;
    var meldet = false;
    var currentAuto;
    function addClickHandlerToPolygons(polygons) {
      for (let i = 0; i < polygons.length; i++) {
        Microsoft.Maps.Events.addHandler(polygons[i], "click", function (e) {
          // Shows a databox when a polygon is clicked
          currentPolygon = e;
          getCurrent();
          getAutoWithId(e.target.metadata.osm_id).then(data => {
              currentAuto = data;
          })
          getBuilding(e.target.metadata.osm_id).then(building => {
            getBericht(e.target.metadata.osm_id, building, currentAuto);
          })
          
          if (meldet) {
            showDataboxforadmin(e.target);
          }
          else {
            showDatabox(e.target);  
          }
        });
      }
    }    
    function showDatabox(polygon) {
      // Databoxların hepsini görünür yapar
      databox.style.display = "block";
      databox2.style.display = "block";
      databox3.style.display = "block";
    }

    function showDataboxforadmin(polygon) {
      // Databoxların hepsini görünür yapar
      databox.style.display = "block";
      databox2.style.display = "block";
      databox3.style.display = "none";
    }

    function showDataboxforuser(polygon) {
      // Databoxların hepsini görünür yapar
      databox.style.display = "block";
      databox2.style.display = "none";
      databox3.style.display = "block";
    }

    function closeDatabox(databoxId) {
      //Tıklanan databoxı kapatır
      const databox = document.getElementById(databoxId);
      if (databox) {
        databox.style.display = "none";
      }
    }


    window.addEventListener("load", () => {
      const buttons = document.querySelectorAll("#databox2 .buttons button, #databox3 .buttons button");
      buttons.forEach((button, index) => {
        button.addEventListener("click", () => {
          levelofdestruction = index + 1;
          // visually indicate which button was clicked
          buttons.forEach((btn) => btn.classList.remove("clicked"));
          button.classList.add("clicked");
        });
      });
    });



  </script>
</head>
<body id="page2">
<div id="tadyaMap"></div>
<div id="databox"> <!-- Databox1 ayarları-->
    <div class="close-button" onclick="closeDatabox('databox')">X</div>
    <div id="title">Level of destruction</div>
    <div class="buttons">
        <button>1</button>
        <button>2</button>
        <button>3</button>
        <button>4</button>
    </div>
    <div class="rows">
        <div id="destruction" class="row"></div>
        <div id="report-time" class="row"></div>
        <div id="alert-time" class="row"></div>
        <div id="deaths" class="row"></div>
        <div id="injured" class="row"></div>
        <div id="authorized" class="row"></div>
        <div id="facility" class="row"></div>
        <div id="number" class="row"></div>
    </div>
</div>
<div id="databox2"> <!-- Databox 2 ayarları -->
    <div class="close-button" onclick="closeDatabox('databox2')">X</div>
    <div id="title">Level of destruction</div>
    <div class="buttons">
        <button>1</button>
        <button>2</button>
        <button>3</button>
        <button>4</button>
    </div>
    <div class="rows">
        <div class="row"><br></div>
        <div class="row">Tote:</div>
        <input type="text" id="tote" name="Tote:" /><br />
        <div class="row">Verletzte:</div>
        <input type="text" id="verletzte" name="Verletzte" /><br />
        <div class="row"><br></div>
    </div>
    <div id="confirmbutton"><button>bestätigen</button></div>
</div>
<div id="databox3"> <!-- Databox 3 ayarları -->
    <div class="close-button" onclick="closeDatabox('databox3')">X</div>
    <div class="row"><br></div>
    <div id="helpbutton"><button>Hilfe anfordern</button></div>
</div>

<script>

  const buttonsDiv = document.querySelector('#databox2 .buttons');
  const buttons = buttonsDiv.getElementsByTagName('button');

  for (let i = 0; i < buttons.length; i++) {
    buttons[i].addEventListener('click', buttonClickHandler);
  }

  document.getElementById("helpbutton").addEventListener("click", function() {
      console.log("tıkladın");
      sendBuildings(currentPolygon);
  });
  document.getElementById("confirmbutton").addEventListener("click", function() {
      var tote = document.getElementById("tote").value;
      var verletzte = document.getElementById("verletzte").value;
      console.log("rapor yollandı");
      sendBericht(currentPolygon, tote, verletzte);
  });
</script>

</body>
</html>